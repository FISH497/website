---
title: "Using R Markdown for publications"
author: "Mark Scheuerell"
date: "17 February 2021"
output:
  html_document:
    theme: readable
    highlight: textmate
    toc: true
    toc_float: true
    toc_depth: 3
bibliography: "references.bib"
csl: "ecology.csl"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("knitcitations")
cleanbib()
```

***

# `knitcitations` package

## Cite by DOI

You can cite an article by its DOI, using either `citep()` or `citet()`, and the full citation information will be gathered automatically. For example, the inline command

```{r eval = FALSE}
`r citep("10.1890/11-0011.1")`
```

will do two things:

1) create an `(Author[s] Year)` inline citation that looks like **`r citep("10.1890/11-0011.1")`**

2) create the following **BibTeX** reference that can be cited elsewhere using `[@Abrams_2012]` or `@Abrams_2012`: 

```
@Article{Abrams_2012,
  doi = {10.1890/11-0011.1},
  url = {https://doi.org/10.1890/11-0011.1},
  year = {2012},
  month = {feb},
  publisher = {Wiley},
  volume = {93},
  number = {2},
  pages = {281--293},
  author = {Peter A. Abrams and Lasse Ruokolainen and Brian J. Shuter and Kevin S. McCann},
  title = {Harvesting creates ecological traps: consequences of invisible mortality risks in predator{\textendash}prey metacommunities},
  journal = {Ecology},
}
```

On the other hand, the inline command

```{r eval = FALSE}
`r citet("10.1098/rspb.2013.1372")`
```

will do two things:

1) create an `Author[s] (Year)` inline citation that looks like **`r citet("10.1098/rspb.2013.1372")`**

2) create the following **BibTeX** reference that can be cited elsewhere using `[@Boettiger_2013]` or `@Boettiger_2013`: 

```
@Article{Boettiger_2013,
  doi = {10.1098/rspb.2013.1372},
  url = {https://doi.org/10.1098/rspb.2013.1372},
  year = {2013},
  month = {sep},
  publisher = {The Royal Society},
  volume = {280},
  number = {1766},
  pages = {20131372},
  author = {Carl Boettiger and Alan Hastings},
  title = {No early warning signals for stochastic transitions: insights from large deviation theory},
  journal = {Proceedings of the Royal Society B: Biological Sciences},
}
```


## Cite by URL

Not all the literature we may wish to cite includes DOIs, such as **arXiv** preprints, Wikipedia pages, or other academic blogs. `{knitcitations}` can produce citations from any URL using the Greycite API. For example, we can use the call 

```{r, eval = FALSE}
`r citep("http://knowledgeblog.org/greycite")`
```

to generate the citation to the Greycite tool, which will render as **`r citep("http://knowledgeblog.org/greycite")`** and produce the following **BibTeX** reference that can be cited elsewhere using `[@greycite32194]` or `@greycite32194`.

```
@Misc{greycite32194,
  url = {http://knowledgeblog.org/greycite},
  title = {Greycite},
  journal = {Knowledge Blog},
  year = {2012},
  howpublished = {\url{http://knowledgeblog.org/greycite}},
  author = {Phillip Lord},
  archived = {http://greycite.knowledgeblog.org/?uri=http%3A%2F%2Fknowledgeblog.org%2Fgreycite, http://wayback.archive.org/web/http://knowledgeblog.org/greycite},
}
```

## Cite **BibTeX** objects directly

We can also cite **BibTeX** objects directly, such as those that **R** provides for citing packages using the `citation()` function. So, for example, here are the citations for the `{knitr}` package

```{r}
citation("knitr")
```

We can use the following inline command

```{r, eval = FALSE}
`r citep(citation("knitr"))`
```

to generate the 3 **BibTeX** objects as

```
@InCollection{Xie_2014,
  booktitle = {Implementing Reproducible Computational Research},
  editor = {Victoria Stodden and Friedrich Leisch and Roger D. Peng},
  title = {knitr: A Comprehensive Tool for Reproducible Research in {R}},
  author = {Yihui Xie},
  publisher = {Chapman and Hall/CRC},
  year = {2014},
  note = {ISBN 978-1466561595},
  url = {http://www.crcpress.com/product/isbn/9781466561595},
}

@Book{Xie_2015,
  title = {Dynamic Documents with {R} and knitr},
  author = {Yihui Xie},
  publisher = {Chapman and Hall/CRC},
  address = {Boca Raton, Florida},
  year = {2015},
  edition = {2nd},
  note = {ISBN 978-1498716963},
  url = {https://yihui.org/knitr/},
}

@Manual{Xie_2020,
  title = {knitr: A General-Purpose Package for Dynamic Report Generation in R},
  author = {Yihui Xie},
  year = {2020},
  note = {R package version 1.30},
  url = {https://yihui.org/knitr/},
}
```

and also create the citation

**`r citep(citation("knitr"))`**

We can now cite the package with normal **BibTeX** entries and pandoc will correctly avoid duplicating the author's name. For example,

`[@Xie_2014; @Xie_2015; @Xie_2020]`

will produce

**[@Xie_2014; @Xie_2015; @Xie_2020]**

Similarly, we can cite references that are already included in our `.bib` file using the standard notation, such that

`[@Boettiger_2013]` or `@Boettiger_2013`

will render as

**[@Boettiger_2013]** or **@Boettiger_2013**


## Re-using **BibTeX** keys

When `citep()` or `citet()` are called, they automatically generate a **BibTeX** key in the format `AuthorLastName_Year`. We can then use this key to cite a reference without remembering its DOI. For example,

```{r, eval = FALSE}
`r citep("Abrams_2012")` 
```

will simply create the citation

**[@Abrams_2012]**


## Creating the references cited section

Creating the final references cited section is straightforward. All we have to do is call the function `write.bibtex()` with the name of the `.bib` file and the references will be cited with the formatting specified in the `.cls` file supplied in the document's YAML. For example, we can generate the references cited section  from the citations in this tutorial with the following:

```{r, eval = FALSE}
## create ref cited section
write.bibtex(file = "references.bib")
```

## References

```{r, echo = FALSE, message = FALSE}
## create ref cited section
write.bibtex(file = "references.bib")
```

